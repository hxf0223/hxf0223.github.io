<!DOCTYPE html> <html lang="zh-CN"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Jekyll Chirpy 主题配置优化记录 | Roderick Huang </title> <meta name="author" content="Roderick Huang"> <meta name="description" content="记录 Jekyll Chirpy 主题从部署错误修复到功能优化的完整过程，包括 GitHub Actions 配置、数学公式渲染、目录展开等改进。"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="manifest" href="/manifest.json"> <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff"> <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1a1a2e"> <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
      navigator.serviceWorker.register('/sw.js');
    });
  }
</script> <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' data: https:; media-src 'self' https:; frame-src 'self' https:; connect-src 'self' https:; worker-src 'self';"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?v=a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?v=f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?v=62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?v=591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?v=6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?v=d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://hxf0223.github.io/blog/2025/Jekyll-Chirpy%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96%E8%AE%B0%E5%BD%95/"> <script src="/assets/js/theme.js?v=5fea5159b787642c1bbc1f334d60f883"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?v=5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Roderick</span> Huang </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="fa-solid fa-magnifying-glass"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-half-sun-moon" id="light-toggle-system"></i> <i class="fa-solid fa-moon" id="light-toggle-dark"></i> <i class="fa-solid fa-sun" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Jekyll Chirpy 主题配置优化记录</h1> <p class="post-meta"> Created on February 03, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/jekyll"> <i class="fa-solid fa-hashtag fa-sm"></i> jekyll</a>   <a href="/blog/tag/%E7%BD%91%E7%AB%99"> <i class="fa-solid fa-hashtag fa-sm"></i> 网站</a>   ·   <a href="/blog/category/%E8%AE%A1%E7%AE%97%E6%9C%BA"> <i class="fa-solid fa-tag fa-sm"></i> 计算机</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="概述">概述</h2> <p>本文记录了将 Jekyll 博客从 <code class="language-plaintext highlighter-rouge">chirpy-starter</code> 迁移到完整 <code class="language-plaintext highlighter-rouge">jekyll-theme-chirpy</code> 主题后遇到的问题及解决方案，以及后续的一系列优化改进。主要涵盖：</p> <ol> <li>GitHub Pages 部署错误修复</li> <li>数学公式渲染引擎切换（MathJax → KaTeX）</li> <li>目录（TOC）展开配置优化</li> </ol> <h2 id="一部署错误修复">一、部署错误修复</h2> <h3 id="问题背景">问题背景</h3> <p>从 <code class="language-plaintext highlighter-rouge">chirpy-starter</code> 切换到 <code class="language-plaintext highlighter-rouge">jekyll-theme-chirpy</code> 完整主题后，GitHub Actions 部署失败，错误信息为：</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: Can't find stylesheet to import.
  ╷
3 │ @import 'colors/typography-light';
</code></pre></div></div> <h3 id="根本原因">根本原因</h3> <p><code class="language-plaintext highlighter-rouge">chirpy-starter</code> 使用预编译的静态资源，而 <code class="language-plaintext highlighter-rouge">jekyll-theme-chirpy</code> 完整主题需要在构建时编译 SCSS 和 JavaScript 文件。GitHub Actions 工作流缺少 Node.js 环境和前端资源构建步骤。</p> <h3 id="解决方案">解决方案</h3> <h4 id="1-添加-nodejs-环境和构建步骤">1. 添加 Node.js 环境和构建步骤</h4> <p>修改 <code class="language-plaintext highlighter-rouge">.github/workflows/pages-deploy.yml</code>，在 Jekyll 构建之前添加：</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Node.js</span>
  <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v4</span>
  <span class="na">with</span><span class="pi">:</span>
    <span class="na">node-version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">20"</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
  <span class="na">run</span><span class="pi">:</span> <span class="s">npm install</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build frontend assets</span>
  <span class="na">run</span><span class="pi">:</span> <span class="s">npm run build</span>
</code></pre></div></div> <p><strong>提交记录</strong>：<code class="language-plaintext highlighter-rouge">847b43c - fix: add Node.js build step for jekyll-theme-chirpy</code></p> <h4 id="2-解决-package-lockjson-缺失问题">2. 解决 package-lock.json 缺失问题</h4> <p>初次构建时遇到 <code class="language-plaintext highlighter-rouge">npm ci</code> 要求 <code class="language-plaintext highlighter-rouge">package-lock.json</code> 的错误。由于 <code class="language-plaintext highlighter-rouge">.gitignore</code> 忽略了该文件，改用 <code class="language-plaintext highlighter-rouge">npm install</code>：</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
  <span class="na">run</span><span class="pi">:</span> <span class="s">npm install</span> <span class="c1"># 改为 npm install</span>
</code></pre></div></div> <p><strong>提交记录</strong>：<code class="language-plaintext highlighter-rouge">251cdcb - fix: use npm install instead of npm ci</code></p> <h4 id="3-解决配置文件冲突">3. 解决配置文件冲突</h4> <p><code class="language-plaintext highlighter-rouge">git pull --rebase</code> 时 <code class="language-plaintext highlighter-rouge">_config.yml</code> 发生合并冲突，保留用户自定义配置（如 avatar 路径），删除冲突标记。</p> <p><strong>提交记录</strong>：<code class="language-plaintext highlighter-rouge">c56b96e - fix: resolve _config.yml merge conflict</code></p> <h2 id="二数学公式渲染优化">二、数学公式渲染优化</h2> <h3 id="从-mathjax-迁移到-katex">从 MathJax 迁移到 KaTeX</h3> <h4 id="迁移动机">迁移动机</h4> <ol> <li> <strong>性能提升</strong>：KaTeX 渲染速度比 MathJax 快 5-10 倍</li> <li> <strong>一致性</strong>：VS Code Markdown 预览使用 KaTeX，切换后本地预览与网站渲染一致</li> <li> <strong>转义字符处理</strong>：KaTeX 对 <code class="language-plaintext highlighter-rouge">\text{row\_offset}</code> 等转义字符的处理更符合预期</li> </ol> <h4 id="实施步骤">实施步骤</h4> <h5 id="1-添加-katex-cdn-资源">1. 添加 KaTeX CDN 资源</h5> <p>修改 <code class="language-plaintext highlighter-rouge">_data/origin/basic.yml</code> 和 <code class="language-plaintext highlighter-rouge">_data/origin/cors.yml</code>：</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># basic.yml</span>
<span class="na">katex</span><span class="pi">:</span>
  <span class="na">css</span><span class="pi">:</span> <span class="s">https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css</span>
  <span class="na">js</span><span class="pi">:</span> <span class="s">https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js</span>
  <span class="na">auto-render</span><span class="pi">:</span> <span class="s">https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js</span>

<span class="c1"># cors.yml</span>
<span class="na">katex</span><span class="pi">:</span> <span class="s">https://cdn.jsdelivr.net</span>
</code></pre></div></div> <h5 id="2-在页面头部加载-katex-css">2. 在页面头部加载 KaTeX CSS</h5> <p>修改 <code class="language-plaintext highlighter-rouge">_includes/head.html</code>，在 <code class="language-plaintext highlighter-rouge">&lt;/head&gt;</code> 之前添加：</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% if page.math %}
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"{{ site.data.origin[origin].katex.css | relative_url }}"</span> <span class="na">integrity=</span><span class="s">"sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span> <span class="nt">/&gt;</span>
{% endif %}
</code></pre></div></div> <h5 id="3-在页面底部加载-katex-javascript">3. 在页面底部加载 KaTeX JavaScript</h5> <p>修改 <code class="language-plaintext highlighter-rouge">_includes/js-selector.html</code>，替换 MathJax 部分：</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% if page.math %}
<span class="c">&lt;!-- KaTeX --&gt;</span>
<span class="nt">&lt;script </span><span class="na">defer</span> <span class="na">src=</span><span class="s">"{{ site.data.origin[origin].katex.js | relative_url }}"</span> <span class="na">integrity=</span><span class="s">"sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">defer</span> <span class="na">src=</span><span class="s">"{{ site.data.origin[origin].katex['auto-render'] | relative_url }}"</span> <span class="na">integrity=</span><span class="s">"sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">defer</span> <span class="na">src=</span><span class="s">"{{ '/assets/js/data/katex.js' | relative_url }}"</span><span class="nt">&gt;&lt;/script&gt;</span>
{% endif %}
</code></pre></div></div> <h5 id="4-创建-katex-配置文件">4. 创建 KaTeX 配置文件</h5> <p>新建 <code class="language-plaintext highlighter-rouge">assets/js/data/katex.js</code> 处理 kramdown 生成的 MathJax 格式标签：</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">DOMContentLoaded</span><span class="dl">"</span><span class="p">,</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Convert kramdown's MathJax format to KaTeX format</span>
  <span class="nb">document</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">script[type='math/tex']</span><span class="dl">"</span><span class="p">).</span><span class="nf">forEach</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">texText</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">textContent</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">span</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">span</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">katex</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">texText</span><span class="p">,</span> <span class="nx">span</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">throwOnError</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">displayMode</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nf">replaceChild</span><span class="p">(</span><span class="nx">span</span><span class="p">,</span> <span class="nx">el</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nb">document</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">script[type='math/tex; mode=display']</span><span class="dl">"</span><span class="p">).</span><span class="nf">forEach</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">texText</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">textContent</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">katex</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="nx">texText</span><span class="p">,</span> <span class="nx">div</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">throwOnError</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">displayMode</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nf">replaceChild</span><span class="p">(</span><span class="nx">div</span><span class="p">,</span> <span class="nx">el</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="c1">// Auto-render for regular KaTeX delimiters</span>
  <span class="nf">renderMathInElement</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">delimiters</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="na">left</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$$</span><span class="dl">"</span><span class="p">,</span> <span class="na">right</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$$</span><span class="dl">"</span><span class="p">,</span> <span class="na">display</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">left</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$</span><span class="dl">"</span><span class="p">,</span> <span class="na">right</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$</span><span class="dl">"</span><span class="p">,</span> <span class="na">display</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
    <span class="p">],</span>
    <span class="na">throwOnError</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div> <h5 id="5-启用数学公式支持">5. 启用数学公式支持</h5> <p>修改 <code class="language-plaintext highlighter-rouge">_config.yml</code> 的 <code class="language-plaintext highlighter-rouge">defaults</code> 配置，为所有文章启用数学公式：</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">defaults</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">scope</span><span class="pi">:</span>
      <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">posts</span>
    <span class="na">values</span><span class="pi">:</span>
      <span class="na">math</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div> <p><strong>提交记录</strong>：</p> <ul> <li><code class="language-plaintext highlighter-rouge">90b1eb3 - render math formular using MathJax</code></li> <li><code class="language-plaintext highlighter-rouge">c69851b - update: add Katex and use Katex for math render</code></li> </ul> <h2 id="三目录toc展开优化">三、目录（TOC）展开优化</h2> <h3 id="问题描述">问题描述</h3> <p>默认情况下，TOC（Table of Contents）只在滚动到某个二级标题时才展开其下的三级、四级标题，影响导航体验。</p> <h3 id="优化目标">优化目标</h3> <p>让所有标题级别（h2、h3、h4）默认完全展开，方便用户快速定位内容。</p> <h3 id="实施方案">实施方案</h3> <h4 id="1-修改桌面端-toc-配置">1. 修改桌面端 TOC 配置</h4> <p>编辑 <code class="language-plaintext highlighter-rouge">_javascript/modules/components/toc/toc-desktop.js</code>：</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">tocSelector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#toc</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">contentSelector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">.content</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">ignoreSelector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">[data-toc-skip]</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">headingSelector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">h2, h3, h4</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">orderedList</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">scrollSmooth</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">collapseDepth</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="c1">// 新增：展开所有标题级别</span>
  <span class="na">headingsOffset</span><span class="p">:</span> <span class="mi">32</span>
<span class="p">};</span>
</code></pre></div></div> <h4 id="2-更新编译后的-javascript">2. 更新编译后的 JavaScript</h4> <p>由于本地环境未安装 Node.js，直接修改编译后的文件 <code class="language-plaintext highlighter-rouge">assets/js/dist/post.min.js</code>：</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 找到 tocbot 配置部分，添加 collapseDepth:6</span>
<span class="nc">P</span><span class="p">(</span><span class="nx">Mn</span><span class="p">,</span> <span class="dl">"</span><span class="s2">options</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">tocSelector</span><span class="p">:</span> <span class="dl">"</span><span class="s2">#toc</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">contentSelector</span><span class="p">:</span> <span class="dl">"</span><span class="s2">.content</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">ignoreSelector</span><span class="p">:</span> <span class="dl">"</span><span class="s2">[data-toc-skip]</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">headingSelector</span><span class="p">:</span> <span class="dl">"</span><span class="s2">h2, h3, h4</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">orderedList</span><span class="p">:</span> <span class="o">!</span><span class="mi">1</span><span class="p">,</span>
  <span class="na">scrollSmooth</span><span class="p">:</span> <span class="o">!</span><span class="mi">1</span><span class="p">,</span>
  <span class="na">collapseDepth</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="c1">// 添加此行</span>
  <span class="na">headingsOffset</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div> <p><strong>提交记录</strong>：<code class="language-plaintext highlighter-rouge">812ebd7 - enable unroll all sub-directories in dir list</code></p> <h3 id="配置说明">配置说明</h3> <ul> <li> <code class="language-plaintext highlighter-rouge">collapseDepth: 6</code>：展开前 6 级标题</li> <li>由于博客使用 h2-h4（3 级标题），设置为 6 确保所有标题完全展开</li> <li>用户刷新页面（Ctrl+F5）即可看到效果</li> </ul> <h2 id="四经验总结">四、经验总结</h2> <h3 id="1-主题选择建议">1. 主题选择建议</h3> <ul> <li> <strong>chirpy-starter</strong>：适合快速搭建，使用预编译资源，无需本地构建</li> <li> <strong>jekyll-theme-chirpy</strong>：适合深度定制，需要配置 Node.js 构建环境</li> </ul> <h3 id="2-cicd-最佳实践">2. CI/CD 最佳实践</h3> <ul> <li>完整主题需在 GitHub Actions 中添加 Node.js 环境</li> <li>优先使用 <code class="language-plaintext highlighter-rouge">npm install</code> 而非 <code class="language-plaintext highlighter-rouge">npm ci</code>（如果不追踪 package-lock.json）</li> <li>构建顺序：Node.js 环境 → npm install → npm build → Jekyll build</li> </ul> <h3 id="3-数学公式渲染选择">3. 数学公式渲染选择</h3> <table> <thead> <tr> <th>特性</th> <th>MathJax</th> <th>KaTeX</th> </tr> </thead> <tbody> <tr> <td>渲染速度</td> <td>较慢</td> <td>快（5-10倍）</td> </tr> <tr> <td>功能完整度</td> <td>非常完整</td> <td>覆盖常用功能</td> </tr> <tr> <td>包大小</td> <td>较大（~200KB）</td> <td>较小（~100KB）</td> </tr> <tr> <td>VS Code 预览</td> <td>✗</td> <td>✓</td> </tr> <tr> <td>转义字符处理</td> <td>需额外配置</td> <td>原生支持</td> </tr> </tbody> </table> <p><strong>推荐</strong>：对于技术博客，KaTeX 是更好的选择。</p> <h2 id="六支持-katex-服务器端渲染pr-2603">六、支持 KaTeX 服务器端渲染（PR #2603）</h2> <h3 id="背景">背景</h3> <p>参考上游仓库 PR <a href="https://github.com/cotes2020/jekyll-theme-chirpy/pull/2603" rel="external nofollow noopener" target="_blank">#2603</a>，该 PR 添加了对 KaTeX 服务器端渲染的支持，通过 jektex 插件在构建时渲染数学公式，而不是在浏览器端通过 JavaScript 渲染。</p> <h3 id="实施方案-1">实施方案</h3> <h4 id="1-添加数学引擎配置">1. 添加数学引擎配置</h4> <p>修改 <code class="language-plaintext highlighter-rouge">_config.yml</code>，添加数学引擎选择配置：</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Math equation rendering engine.</span>
<span class="na">math</span><span class="pi">:</span>
  <span class="c1"># Choose engine for rendering math equations.</span>
  <span class="c1"># mathjax — client-side rendering (loads JavaScript library)</span>
  <span class="c1"># katex — server-side rendering via jektex plugin (faster, no JS required)</span>
  <span class="na">engine</span><span class="pi">:</span> <span class="c1"># [mathjax | katex]</span>
</code></pre></div></div> <h4 id="2-添加-jektex-配置">2. 添加 jektex 配置</h4> <p>在 <code class="language-plaintext highlighter-rouge">_config.yml</code> 的 kramdown 配置后添加 jektex 配置：</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Jektex configuration for server-side KaTeX rendering</span>
<span class="na">jektex</span><span class="pi">:</span>
  <span class="na">cache_dir</span><span class="pi">:</span> <span class="s2">"</span><span class="s">.jektex-cache"</span> <span class="c1"># Cache directory for rendered equations</span>
  <span class="na">ignore</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">**/*"</span><span class="pi">]</span> <span class="c1"># Ignore all by default (enable when math.engine is katex)</span>
  <span class="na">silent</span><span class="pi">:</span> <span class="kc">false</span> <span class="c1"># Show rendering progress</span>
  <span class="na">macros</span><span class="pi">:</span> <span class="pi">[]</span> <span class="c1"># Global LaTeX macros (e.g., [["\\\\Q", "\\\\mathbb{Q}"]])</span>
</code></pre></div></div> <h4 id="3-更新-gitignore">3. 更新 .gitignore</h4> <p>添加 jektex 缓存目录到 <code class="language-plaintext highlighter-rouge">.gitignore</code>：</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Misc
.jektex-cache
</code></pre></div></div> <h4 id="4-条件加载-css">4. 条件加载 CSS</h4> <p>修改 <code class="language-plaintext highlighter-rouge">_includes/head.html</code>，根据引擎类型加载 CSS：</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% if page.math %} {% assign math_engine = site.math.engine | default: 'mathjax' %} {% if math_engine == 'katex' %}
<span class="c">&lt;!-- KaTeX CSS for server-side rendering --&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"{{ site.data.origin[type].katex.css | relative_url }}"</span> <span class="nt">/&gt;</span>
{% endif %} {% endif %}
</code></pre></div></div> <h4 id="5-条件加载-javascript">5. 条件加载 JavaScript</h4> <p>修改 <code class="language-plaintext highlighter-rouge">_includes/js-selector.html</code>，只在使用 MathJax 时加载 JS：</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% if page.math %} {% assign math_engine = site.math.engine | default: 'mathjax' %} {% if math_engine == 'mathjax' %}
<span class="c">&lt;!-- MathJax --&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"{{ '/assets/js/data/mathjax.js' | relative_url }}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">async</span> <span class="na">src=</span><span class="s">"https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">id=</span><span class="s">"MathJax-script"</span> <span class="na">async</span> <span class="na">src=</span><span class="s">"{{ site.data.origin[type].mathjax.js | relative_url }}"</span><span class="nt">&gt;&lt;/script&gt;</span>
{% endif %} {%- comment -%} KaTeX is rendered server-side via jektex plugin, only CSS needed {%- endcomment -%} {% endif %}
</code></pre></div></div> <h4 id="6-添加-katex-样式">6. 添加 KaTeX 样式</h4> <p>修改 <code class="language-plaintext highlighter-rouge">_sass/base/_base.scss</code>，添加 KaTeX 溢出处理：</p> <div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* KaTeX */</span>
<span class="nc">.katex-display</span> <span class="p">{</span>
  <span class="nl">overflow</span><span class="p">:</span> <span class="nb">auto</span> <span class="nb">hidden</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="7-添加-jektex-依赖">7. 添加 jektex 依赖</h4> <p>修改 <code class="language-plaintext highlighter-rouge">jekyll-theme-chirpy.gemspec</code>，添加 jektex 依赖：</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spec</span><span class="p">.</span><span class="nf">add_runtime_dependency</span> <span class="s2">"jektex"</span><span class="p">,</span> <span class="s2">"~&gt; 0.1.1"</span>
</code></pre></div></div> <h3 id="使用方法">使用方法</h3> <h4 id="选择-mathjax默认">选择 MathJax（默认）</h4> <p>不需要配置，或显式设置：</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">math</span><span class="pi">:</span>
  <span class="na">engine</span><span class="pi">:</span> <span class="s">mathjax</span>
</code></pre></div></div> <h4 id="选择-katex">选择 KaTeX</h4> <p>在 <code class="language-plaintext highlighter-rouge">_config.yml</code> 中设置：</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">math</span><span class="pi">:</span>
  <span class="na">engine</span><span class="pi">:</span> <span class="s">katex</span>

<span class="na">jektex</span><span class="pi">:</span>
  <span class="na">ignore</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">*.xml"</span><span class="pi">]</span> <span class="c1"># 处理 markdown 文件，忽略 feed.xml</span>
</code></pre></div></div> <p>然后运行：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle add jektex
bundle <span class="nb">install</span>
</code></pre></div></div> <h3 id="特性对比">特性对比</h3> <table> <thead> <tr> <th>特性</th> <th>MathJax</th> <th>KaTeX (jektex)</th> </tr> </thead> <tbody> <tr> <td>渲染方式</td> <td>客户端 JavaScript</td> <td>服务器端构建时</td> </tr> <tr> <td>页面加载速度</td> <td>较慢</td> <td>快</td> </tr> <tr> <td>LaTeX 支持</td> <td>更完整</td> <td>常用功能完整</td> </tr> <tr> <td> <code class="language-plaintext highlighter-rouge">\label</code> 和 <code class="language-plaintext highlighter-rouge">\eqref</code> </td> <td>✓</td> <td>✗</td> </tr> <tr> <td>需要 JavaScript</td> <td>✓</td> <td>✗</td> </tr> <tr> <td>缓存支持</td> <td>✗</td> <td>✓</td> </tr> </tbody> </table> <h3 id="注意事项">注意事项</h3> <ol> <li> <strong>兼容性</strong>：KaTeX 不支持某些 LaTeX 特性，如 <code class="language-plaintext highlighter-rouge">\label</code> 和 <code class="language-plaintext highlighter-rouge">\eqref</code> </li> <li> <strong>构建时间</strong>：首次构建时，KaTeX 会渲染所有公式并缓存，后续构建会快很多</li> <li> <strong>默认行为</strong>：如果不配置 <code class="language-plaintext highlighter-rouge">math.engine</code>，默认使用 MathJax（保持向后兼容）</li> </ol> <p><strong>提交记录</strong>：参考 PR <a href="https://github.com/cotes2020/jekyll-theme-chirpy/pull/2603" rel="external nofollow noopener" target="_blank">#2603</a></p> <h3 id="4-配置文件管理">4. 配置文件管理</h3> <ul> <li>关键配置文件建议纳入版本控制</li> <li>合并冲突时优先保留自定义配置</li> <li>及时提交配置变更，便于回溯</li> </ul> <h2 id="五参考资源">五、参考资源</h2> <ul> <li><a href="https://github.com/cotes2020/jekyll-theme-chirpy" rel="external nofollow noopener" target="_blank">Jekyll Chirpy Theme</a></li> <li><a href="https://katex.org/" rel="external nofollow noopener" target="_blank">KaTeX Documentation</a></li> <li><a href="https://tscanlin.github.io/tocbot/" rel="external nofollow noopener" target="_blank">tocbot Configuration</a></li> <li><a href="https://github.com/actions/setup-node" rel="external nofollow noopener" target="_blank">GitHub Actions - setup-node</a></li> </ul> <h2 id="附录完整文件清单">附录：完整文件清单</h2> <p>本次优化涉及的主要文件：</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.github/workflows/pages-deploy.yml    # CI/CD 配置
_config.yml                           # Jekyll 全局配置
_data/origin/basic.yml                # CDN 资源配置
_data/origin/cors.yml                 # CORS 配置
_includes/head.html                   # 页面头部（KaTeX CSS）
_includes/js-selector.html            # 脚本加载器（KaTeX JS）
assets/js/data/katex.js              # KaTeX 配置脚本（新建）
_javascript/modules/components/toc/toc-desktop.js  # TOC 桌面端配置
assets/js/dist/post.min.js           # 编译后的 JS（TOC 配置）
</code></pre></div></div> <hr> <p>通过这一系列优化，博客成功完成了主题迁移，并在性能和用户体验上都有明显提升。后续可以继续探索更多主题定制选项。</p> <h2 id="链接">链接</h2> <ul> <li><a href="https://chirpy.cotes.page/posts/getting-started/" rel="external nofollow noopener" target="_blank">Chirpy Jekyll Theme – Tutorial</a></li> <li><a href="https://github.com/cotes2020/jekyll-theme-chirpy" rel="external nofollow noopener" target="_blank">Chirpy Jekyll Theme</a></li> <li><a href="https://jekylldo.cn/docs/configuration/markdown/" rel="external nofollow noopener" target="_blank">Markdown 渲染器配置选项</a></li> </ul> <h2 id="其他主题">其他主题</h2> <ul> <li> <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a>：另一个流行的 Jekyll 主题，适合学术博客，支持 LaTeX 数学公式和丰富的功能。</li> <li> <a href="https://github.com/academicpages/academicpages.github.io" rel="external nofollow noopener" target="_blank">Academic Pages</a>：适合学术博客，支持 LaTeX 数学公式和丰富的功能。</li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/al-folio-local-deploy-ubuntu2404/">al-folio 本地部署记录（Ubuntu 24.04）</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/C++-Traits/">C++ Traits</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/%E9%81%93%E6%A0%BC%E6%8B%89%E6%96%AF-%E6%99%AE%E5%85%8B%E7%AE%97%E6%B3%95/">道格拉斯-普克算法(Douglas–Peucker algorithm)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/CMake%E6%94%AF%E6%8C%81%E5%BA%93/">CMake支持库收集</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/QGC%E9%A3%9E%E8%A1%8C%E5%89%8D%E6%A3%80%E6%9F%A5/">QGC代码架构解析：飞行前检查（起飞条件）</a> </li> </div> </div> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 Roderick Huang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?v=a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?v=85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?v=c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?v=2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?v=c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/assets/js/copy_code.js?v=c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?v=d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?v=a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?v=2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?v=f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?v=a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?v=6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?v=ccc841c459bfc0e64c1c2b5acd10df02"></script> </body> </html>